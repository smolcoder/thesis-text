\chapter{Апробация} 
\label{approbation}

В данной главе будет описан подход к решению задачи в рекомендациях музыки социальной сети ``Одноклассники'', основанный на переходе
от трека к исполнителю, а также будут приведены результаты, показывающие улучшение рекомендаций после апробации данного подхода.

\section{Музыкальный сервис социальной сети “Одноклассники”}

Музыкальный сервис социальной сети ``Одноклассники'' доступен каждому зарегистрированному пользователю. Среди многочисленных возможностей, 
которые осуществляет сервис, имеются также рекомендации песен и исполнителей, формирование индивидуальных радиостанций. Устроены они на 
основе \emph{коллаборативной фильтрации}~\cite{bugaychenko}. То есть для определения вкусов пользователей и рекомендации им подходящей музыки анализируется 
их активность в музыкальном сервисе: что слушал человек, как долго, в каком порядке, как много раз, что из прослушанного было добавлено 
в собственные списки, какие треки слушались подряд и так далее. Затем на основе этой информации определяются \emph{похожие} треки и исполнители,
которые и попадают в списки рекомендаций. Например, если зайти на страницу с музыкой какого-либо исполнителя, то вниманию пользователя будут 
предложены не только его песни, но 16 похожих на него исполнителей.

\section{Проблема определения похожих исполнителей}

На портале регулярно происходит обновление списка пар похожих исполнителей, в процессе которого пересчитываются коэффициенты ``похожести''.
Как уже отмечалось, на эти коэффициенты влияет пользовательская активность. Таким образом поддерживается актуальность рекомендаций.
Так как люди могут слушают музыку из разных направлений, обладать разностаронними вкусами, то в списки рекомендаций могут попадать совершенно
непохожие исполнители. Например, похожими считаются современная исполнительница поп-музыки Нюша и шансон-дуэт Ирины Круг и Алексея Брянцева.
Более наглядные примеры, когда на странице минимал-техно исполнителя Bugge Wesseltoft рекомендуется современная русская поп-музыка, или же 
на странице симфо-метал исполнительницы Tarja Turunen в списках похожих показывается хип-хоп.

Объяснить подобные ``промахи'' можно следующим образом: большинство людей вне зависимости от своих вкуснов все же слушают современную популярную
музыку, мешая ее в плейлистах с более узкими жанрами \ld рэп, метал, классика. Поэтому если большое количество любящих минимал-техно пользователей 
просшулают новую песню той же Нюши, то она покажется рекомендательной системе похожей на ту музыку, которую обычно слушают эти пользователи. В данном
случае это Bugge Wesseltoft.

Чтобы указать на еще одну причину подобного смешения рекомендаций, рассмотрим в качестве примера рэпкор-группу Crazy Town, которая появляется в 
рекомендациях у некоторых поп-исполнителей, несмотря на направление музыки данной группы \ld ню-метал, рэп-рок, альтернативный рок. Дело в том,
что у данной группы есть песни-хиты, которые популярны в широкой публике, а не только среди любителей перечисленных выше жанров. Одной из таких песен
является ``Butterfly'', которую слушают вместе с остальной популярной музыкой. Благодаря этому данная группа считается похожей на исполнителей
совершенно других направлений.

Таким образом возникает следующая задача: отфильтровать списки рекомендаций, полученные коллаборативной фильтрацией, убрав из них пары заведомо 
непохожих исполнителей.

\section{Описание предлагаемого подхода}

Поставим задачу более формально. Имеется пара исполнителей, которые коллаборативная рекомендательная система посчитала похожими. 
Необходимо определить, являются ли эти исполнители \emph{непохожими}, либо пропустить эту пару. 

Предлагаемый для решения поставленной задачи подход основан на переходе от тегов трека к тегам исполнителя с некоторыми модификациями, 
связанными с особенностями поставленной задачи. 

Сначала все теги разделяются на \emph{кластеры} \ld множества тегов, которые
часто ассоциируются с одним и тем же треком \emph{одновременно}. Этот процесс можно сравнить с выделением синонимичных тегов, о которых
шла речь в \cite{msordo_thesis}. Для этого предлагается построить неориентированный взвешенный граф, вершинами которого являются теги, а весом ребра между
тегами $w_1$ и $w_2$ является величина
$$ \max \left ( \frac{|w_1 \cap w_2|}{|w_1|}, \frac{|w_1 \cap w_2|}{|w_2|} \right ) $$,
где $|w_1|, |w_2|$ \ld количество треков, помеченных тегами $w_1, w_2$ соответственно, $|w_1 \cap w_2|$ \ld количество треков, 
помеченных обоими тегами сразу. Затем в графе отбрасываются ребра, вес которых ниже определенного порога, получаемого эмпирически с 
использованием экспертной оценки объединенных тегов. Например, в нашем случае требовалось, чтобы теги ``хип-хоп'' и ``рэп''
были в одном кластере, а ``метал'' и ``классика'' \ld в разных. Пусть теперь имеется треки $t_1$ и $t_2$, и с ними ассоциированы множества тегов
$W_1, W_2$ соответственно. Пусть также $C_1, C_2$ \ld множества кластеров, которым принадлежат теги из $W_1, W_2$ соответственно. 
Так как теги разных кластеров ассоциируются с одной и той же песней достаточно редко, то логично предположить, что если $C_1 \cap C_2 = \varnothing$, 
то данные треки скорее всего не похожи. Действительно, если трактовать данное разбиение на кластеры как выделение схожих 
музыкальных направлений, то в таком случае эти треки будут принадлежать разным направлениям.

В итоге, чтобы отфильтровать непохожих исполнителей, необходимо:
\begin{itemize}
 \item протегировать треки исполнителей;
 \item выполнить переход к каждому из исполнителей;
 \item определить кластеры, к которым относятся теги исполнителей;
 \item если множества кластеров не пересекаются, то считать исполнителей непохожими.
\end{itemize}

\section{Результаты}

Проверке не похожесть подверглось около 17 миллионов пар исполнителей. На каждого исполнителя бралось от 6 до 10 треков. Тегирование производилось 
алгоритмом $k$-NN с косинусной метрикой при $k = 18$. Словарь состоял из 27 жанровых тегов, которые разбились на 15 кластеров.
Для оценки качества предложенной фильтрации было вручную выбрано 200 пар исполнителей, среди которых 100
были похожими, а другие 100 \ld нет. В результате фильтрации из 100 похожих исполнителей осталось 93, а из 100 непохожих \ld 8.
Применение данной дополнительной фильтрации повлияло не только на рекомендации, но и на формирование пользовательских радиостанций.
Например, в радиостанции ``Индастриал-метал'' перестала попадаться поп-музыка.

\section{Выводы}

В данной главе была сформулирована проблема фильтрации непохожих исполнителей в социальной сети ``Одноклассники''. Также был сформулирован подход к ее решению
на основе перехода к исполнителю и выделения кластеров с тегами. Данный метод был внедрен в существующую фильтрацию и показал хорошие результаты.