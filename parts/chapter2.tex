\chapter{Описание реализованного подхода}
\label{chapter2}

В данной главе формулируется цель данной работы и описывается разработанный метод улучшения существующих подходов 
к решению задачи автотегирования методами ближайших соседей.

\section{Постановка задачи}
Целью данной работы является улучшение алгоритмов ближайших соседей. Требования к данной работе:
\begin{itemize}
 \item Разработать метод улучшения существующих алгоритмов на основе перехода от трека к ее исполнителю;
 \item Провести сравнение разработанного метода с существующими современными методами на множестве русских песен;
 \item Апробировать предложенный подход для фильтрации похожих исполнителей в музыкальных рекомендациях социальной сети ``Одноклассники''.
\end{itemize}

Имеется достаточно много исследований, которые проверялись на зарубежной (в основном, англоязычной) музыке. Но применить результаты этих работ к русской музыке напрямую нельзя, 
так как для нее характерны свои жанры, национальные особенности.
К тому же нет пригодных для исследований размеченных подборок русской музыки, аналогичных, например, подборкам CAL500, CAL10K, MIREX и т.д.
Поэтому в данной работе сделан акцент именно на русскую музыку.

\section{Переход от трека к исполнителю}

В главе \ref{chapter1} были описаны два основных алгоритма, основанных на методе ближайших соседей: взвешенный k-NN (k Nearest Neighbors) и CBDC (Class-based Distance Classifier).
Также были отмечены сильные и слабые стороны каждого из них в задачах сопоставления тегов треку и поиску песен по тегу. Но оба этих метода используют для тегирования конкретного трека
информацию только о нем самом. Предлагаемый метод учитывает эту информацию. Приведем сначала общее, затем формальное описание метода.

\subsection{Общее описание}

Нередко люди угадывают исполнителя по впервые услышанному треку, даже прослушав короткий его отрывок.
Сформулируем несколько наблюдений, которые помогут понять, почему такое случается:
\begin{itemize}
 \item треки конкретного исполнителя как правило принадлежат одному и тому же жанру (или ограниченному множеству жанров);
 \item в мелодиях разных песен конкретного исполнителя присутствуют одни и те же (или похожие на слух) \emph{сeмплы}\footnote{Семпл (англ. sample) \ld 
 относительно небольшой оцифрованный звуковой фрагмент (ru.wikipedia.org)} и т.д.
\end{itemize}
Разумеется, это всего лишь наблюдения, которые верны хоть и в большинстве случаев, но не во всех. Тем не менее они кажутся вполне логичными.
Все, что повторяется от трека к треку одного исполнителя (жанр, голос, мелодия, темп и прочие характеристики), откладывается у слушателей в памяти.
Возможно, это одна из причин, по которой мы можем узнавать исполнителей по отрывку одной из песен, даже если никогда ее не слышали.

Но раз человек может таким образом ``запоминать'' исполнителя на слух, выделяя похожие созвучия, то логично предположить, что с точки зрения акустических волн тоже должны выделяться похожие.
А это значит, что после извлечения из песен конкретного исполнителя  характеристических признаков методом, описанным в главе \ref{chapter1}, 
и последующим превращением их в точки некоторого пространства, они окажутся достаточно близкими друг к другу. 
Поэтому мы можем считать характеристиками теги, связь между ними обсуждалась в главе \ref{chapter1}.

Исходя из этих наблюдений, можно сделать предположение, что исполнитель должен обладать теми тегами, которыми обладает большинство его песен.
Значит, если каким-либо образом узнать теги исполнителя, то можно а) продолжить их на новые треки, или же б) корректировать теги существующих песен.
В случае (а) это позволило бы сразу охарактеризовать трек без его непосредственного тегирования, в случае (б) \ld возможно, 
протегировать трек лучше, так как могут исчезнуть ``лишние'' теги или же появиться ``нужные''.

Пусть у нас есть несколько протегированных песен одного исполнителя. Тогда посчитаем для каждого тега, который встречается хотя бы в одном треке, сколько раз он встречается суммарно во всех этих треках.
Полученный процесс и есть \emph{переход к исполнителю}. Его результатом является отображенние из тега в частоту его вхождения в множества тегов песен исполнителя. 
Далее можно различными способами, описанными в главе \ref{chapter1}, выбирать для исполнителя наиболее подходящие теги. После того, как нам стали известны теги исполнителя, можно использовать их для 
тегирования его новых песен и для перетегирования уже имеющихся, повышая таким образом точноть (результаты в главе \ref{results}). Последний шаг назовем \emph{переход от исполнителя к треку}.

Действительно, логично предположить, что если, например, про 7 из 10 песен известно, что они относятся к жанру шансон, то исполнитель в целом 
поет в этом жанре.

В итоге получается следующий метод:
\begin{enumerate}
 \item Протегировать несколько песен конкретного исполнителя одним из обсуждаемых в главе \ref{chapter1} алгоритмов.
 \item Осуществить переход к исполнителю так, как описано выше.
 \item Отфильтровать теги исполнителя.
 \item Выполнить переход от исполнителя к треку, либо задав новые теги, либо обновив существующие.
\end{enumerate}

Отметим положительные и отрицательные стороны предложенного метода.

\emph{Плюсы:} 
\begin{enumerate}
 \item Если у исполнителя достаточно много треков, можно добиться ощутимого прироста в точности тегирования.
 \item Если необходимо знать теги всех песен исполнителя, то данный метод требует столько же времени, сколько и тегирование обычным методом всех песен в отдельности.
 \item В худшем случае (всего одним трек на исполнителя) данный метод вырождается в тот алгоритм, которым производилось первоначальное тегирование трека.
\end{enumerate}

\emph{Минусы:} 
\begin{enumerate}
 \item Если необходимо знать теги лишь одному конкретному треку, то все равно требуется тегировать другие, что отрицательно скажется на времени работы алгоритма.
 \item Метод не отразит индивидуальные характеристики конкретного трека.
\end{enumerate}

\subsection{Формальное описание}

\subsubsection{Вспомогательные определения}

Введем несколько вспомогательных определений.

Как и в главе \ref{chapter1} будем использовать обозначения $S = \{s_1, s_2, \ldots, s_D \}$ \ld некоторое множество песен, $D = |S|$, $ \mcV $ \ld словарь, состоящий из $V$ уникальных слов.

Определим $\mcD = \{ (\mb{x}^1, \mb{y}^1), \ldots, (\mb{x}^D, \mb{y}^D) \}$ \ld набор данных над $S$, множество пар таких, 
что:
\begin{itemize}
 \item с треком $s_i$ ассоциирован вектор $\mb{x}^i = (x^i_1, \ldots, x^i_N)$, где $N$ \ld размерность пространства точек после сужения 
 исходного пространства характеристических признаков, \ld некоторая точка в $\R^N$;
 \item $y^i$ \ld семантический вектор трека $s_i$.
\end{itemize}

\emph{Обучающая выборка} \ld набор данных над некоторым заранее подготовленном множестве песен, про каждую из которых извесен ее семантический вектор.

\emph{Алгоритм автотегирования} над обучающей выборкой $\mcD$ \ld функция ${\mcA}_{\mcD} : \R^N \rightarrow \R^{|{\mcV}|}_{+}$,
аргументом которой является точка из $\R^N$, ассоциированная с некоторым треком, а значением \ld точка из $\R^{|{\mcV}|}_{+}$ \ld семантический вектор.

Обозначим $\art_p = \{s_1, \ldots, s_{n_p} \}$ множество из $n_p$ песен одного и того же исполнителя.

Определим \emph{семантический вектор исполнителя} $\art_p$ как $\ty^p = (\ty^p_1, \ldots, \ty^p_{V})$, причем 
$$\ty^p_i = \sum^{n_p}_{j=1} \left [y^j_i > 0 \right ]$$,
где $[x]$ \ld индикаторная функция, $y^j_i$ \ld принадлежность $i$-ого тега $j$-ому треку исполнителя $\art_p$. Иными словами, семантический вектор исполнителя
для каждого тега из $\mcV$ показывает, сколько песен из $\art_p$ обладают этим тегом.
Без ограничения общности будем считать, что $\forall i: \ty^p_i \gte \ty^p_{i+1}$, то теги упорядочены по неубыванию значений в семантическом векторе исполнителя.

Назовем процесс построения семантического вектора исполнителя \emph{переходом к исполнителю}.

Определим функцию $$count(\mb{y}) = \sum^{V}_{i=1} [y_i > 0]$$,
показывающую, сколькими тегами протегирован трек, соответствующая $\mb{y}$.

Зафиксируем некоторый алгоритм $\mcA = \mcA_{\mcD}$ над некоторой обучающей выборкой $\mcD$, причем $count(\mcA(\mb{x})) = C, \forall x \in \R^N$,
то есть алгоритм с любым треком сопоставляет одинаковое количество тегов.

\subsubsection{Переход от исполнителя к треку}

Пусть выполнен переход к исполнителю, тогда \emph{переход от исполнителя к треку} \ld процесс формирования новых тегов для трека по семантическому вектору исполнителя.

Приведем несколько примеров того, как можно переходить от исполнителя к треку. Пусть у исполнителя $\art$ имеется $M$ песен, то есть $\art = \{ s_1, \ldots, s_M \}$, 
и $\mb{y}$ \ld его семантический вектор. Пусть также $$S_y = \sum_{i=1}^{V} y_i$$, а $C = count(\mb{y})$ \ld количество ненулевых элементов в семантическом векторе $\mb{y}$.
Так как по нашему допущению семантический вектор упорядочен по неубыванию значения своих элементов, то $\{ 1, \ldots, C \}$ \ld номера тегов, которые встречаются хотя бы в одной 
из песен исполнителя $\art$. Пусть $\mcV = \{w_1, \ldots, w_V \}$ \ld словарь тегов, упорядоченный в соответствии с $\mb{y}$. 
Тогда переход от исполнителя к треку можно осуществить, например, следующими способами:
\begin{itemize}
 \item Ассоциировать с треком первые $n$ тегов из $\mcV$.
 \item Ввести \emph{ограничивающий порог} $t \in [0, 1]$ такой, что ассоциировать с треком будем множество тегов 
 $$ \{ w_i \mid \frac{y_i}{S_y} \gte t \} $$.
 \item Брать первые $n$ тегов таких, что $$n = \min \{ n \mid \frac{\sum_{i=1}^{n} y_i}{S_y} \gte t \}$$, $t \in [0, 1]$. Например, $t = 0.85$ будет означать, 
 что мы выбираем те теги, которые покрывают $85\%$ суммарного количества тегов.
\end{itemize}

\subsubsection{Предлагаемый метод}

Обобщая выше сказанное, сформулируем предложенный метод. Пусть имеется алгоритм тегирования $\mcA = \mcA_{\mcD}$ над некоторой обучающей выборкой $\mcD$.
Поступает запрос на тегирование трека $s_q$ исполнителя $\art_p$. Тогда необходимо:
\begin{itemize}
 \item Вычислить $\mb{y}^i = \mcA(\mb{x}^i), \forall i: s_i \in \art_p$.
 \item Выполнить переход к исполнителю.
 \item Выполнить переход от исполнителя к треку (например, одним из предложенных выше способов).
\end{itemize}

\subsubsection{Примеры}

Рассмотрим использование данного подхода на примере двух российских исполнителей \ld Согдиана и Найк Борзов. Так как детальное описание эксперимента будет приведено в главе \ref{results},
здесь отметим лишь основные моменты:
\begin{itemize}
 \item На каждого исполнителя бралось по десять песен.
 \item Фиксировалась одна из десяти песен исполнителя, которая имеется в обучающей выборке. Ее теги в обучающей выборке будем называть оригинальными тегами.
 \item Для перехода от исполнителя к треку использовался первый из описанных выше способов \ld бралось три самых частых тега.
\end{itemize}

Как видно из таблиц \ref{tab:naik_borzov} и \ref{tab:sogdiana}, множество тегов выбранного трека, полученное простым применением 18-NN, 
пересекается с оригинальным множеством тегов лишь в одном теге. Если же выполнить переход от трека к его исполнителю, затем снова перейти к треку, но с уже новыми тегами,
то это пересечение составит уже два тега. Действительно, хоть выбранный трек и зашумлен другими тегами, но большинство песен исполнителя все же обладают нужными тегами.
В результате, эти теги будут иметь высокое значение в семантическом векторе исполнителя, и вероятность ассоциировать треки именно ими возрастает.

\begin{center}
\begin{table}[ht]
\caption{Тегирование исполнителя Найк Борзов}
\label{tab:naik_borzov}
\begin{tabular}{ |p{6cm}|p{9cm}| }
  \hline  
  \multicolumn{2}{ |c| }{Найк Борзов} \\
  \hline  
  \multirow{1}{*}{Оригинальные теги} 
    & Поп-музыка, Рок \\ \hline
  \multirow{1}{*}{До перехода к исполнителю} 
    & Поп-музыка, Эстрадная музыка, Молодежная музыка \\ \hline
  \multirow{1}{*}{После перехода к треку} 
    & Поп-музыка, Рок, Шансон \\ \hline
  \multirow{10}{*}{Теги песен исполнителя} 
    & Поп-музыка, Рок, Шансон \\ 
    & \textbf{Поп-музыка, Молодежная музыка, Эстрадная музыка} \\
    & Поп-музыка, Рок, Дискотека 90-х \\ 
    & Поп-музыка, Рок, Шансон \\ 
    & Поп-музыка, Рок, Шансон \\
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & Поп-музыка, Рок, Шансон \\ 
    & Поп-музыка, Молодежная музыка, Инструментальная музыка \\ 
    & Поп-музыка, Шансон, Реп \\ \hline
\end{tabular}
\end{table}
\end{center}
\begin{center}
\begin{table}[ht]
\caption{Тегирование исполнителя Согдиана}
\label{tab:sogdiana}
\begin{tabular}{ |p{6cm}|p{9cm}| }
  \hline  
  \multicolumn{2}{ |c| }{Согдиана} \\
  \hline  
  \multirow{1}{*}{Оригинальные теги} 
    & Поп-музыка, Молодежная музыка \\ \hline
  \multirow{1}{*}{До перехода к исполнителю} 
    & Поп-музыка, Шансон, Рэп \\ \hline
  \multirow{1}{*}{После перехода к треку} 
    & Поп-музыка, Молодежная музыка, Шансон \\ \hline
  \multirow{10}{*}{Теги песен исполнителя} 
    & Поп-музыка, Рэп, Шансон \\ 
    & Поп-музыка, Молодежная музыка, Танцевальная музыка \\
    & Поп-музыка, Молодежная музыка, Дискотека 90-х \\ 
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & \textbf{Поп-музыка, Шансон, Рэп} \\ 
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & Поп-музыка, Молодежная музыка, Инструментальная музыка \\ 
    & Поп-музыка, Молодежная музыка, Шансон \\ 
    & Поп-музыка, Дискотека 90-х, Шансон \\ 
    & Поп-музыка, Шансон, Рок \\ \hline
\end{tabular}
\end{table}
\end{center}

\section{Выводы}
В данной главе была сформулирована цель данной работы: улучшить существующие подходы к автотегированию и сравнить методы на 	музыке.

Для интуитивного понимания дано общее описание предлагаемого подхода, основанного на переходе от трека к исполнителю посредством тегов других песен данного исполнителя, 
затем приведено его формальное описание. Также введен ряд вспомогательных определений.

В конце главы приводится два примера использования перехода к исполнителю, в которых видно улучшение тегирования.